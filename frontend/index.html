<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthoCAD</title>
    <link rel="stylesheet" href="css/style.css">

    <!-- Three.js r128 + OrbitControls via CDN (r128 is the last version with stable global THREE.OrbitControls) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- occt-import-js: OpenCASCADE WASM for STEP parsing (0.0.23 = latest; global: occtimportjs) -->
    <script src="https://cdn.jsdelivr.net/npm/occt-import-js@0.0.23/dist/occt-import-js.js"></script>
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-brand">
                <h1 class="header-title">SYNTHOCAD</h1>
                <p class="header-subtitle">AI-Powered Parametric CAD Generation Platform</p>
            </div>
        </header>

<!-- Main Layout: 3 Columns (30% - 40% - 30%) -->
        <main class="main">
            <!-- Left Column: Input Controls (30%) -->
            <aside class="left-column">
                <!-- Section A: Prompt Input -->
                <section class="input-section">
                    <label class="section-label">PROMPT</label>
                    <div class="prompt-wrapper">
                        <textarea id="prompt-input" class="prompt-textarea"
                            placeholder="Create a cylinder diameter 20mm height 50mm with center hole 5mm"
                            rows="3"></textarea>
                        <button id="prompt-edit-btn" class="prompt-edit-btn hidden"
                            title="Prompt modified — click Generate to regenerate">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="prompt-btn-row">
                        <button id="generate-btn" class="generate-btn">Generate</button>
                    </div>
                    <div id="error-message" class="error-message"></div>
                </section>

                <!-- Section B: Templates -->
                <section class="templates-section">
                    <label class="section-label">TEMPLATES</label>
                    <div id="templates-list" class="templates-list"></div>
                </section>

                <!-- Section C: Upload STEP -->
                <section class="upload-section">
                    <label class="section-label">UPLOAD STEP</label>
                    <div id="drop-zone" class="drop-zone">
                        <input type="file" id="step-file-input" accept=".step,.stp" class="drop-zone-input">
                        <div class="drop-zone-content">
                            <svg class="drop-zone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                            </svg>
                            <span id="drop-zone-text">Drop .step file or click to browse</span>
                        </div>
                    </div>
                    <div class="upload-btn-row">
                        <button id="render3d-btn" class="preview-btn" disabled>Render 3D</button>
                    </div>
                    <div id="upload-error" class="error-message"></div>
                </section>
            </aside>

            <!-- Center Column: Output Viewers (40%) -->
            <section class="center-column">
                <!-- Tabs -->
                <nav class="tabs">
                    <button class="tab active" data-tab="viewer3d">3D Viewer</button>
                    <button class="tab" data-tab="preview">Preview</button>
                    <button class="tab" data-tab="json">JSON</button>
                    <button class="tab" data-tab="python">Python</button>
                    <button class="tab" data-tab="step">STEP</button>
                </nav>

                <!-- Tab Panels -->
                <div class="tab-panels">
                    <!-- 3D Viewer -->
                    <div class="tab-panel active" id="panel-viewer3d">
                        <div id="step3d-container">
                            <canvas id="step3d-canvas"></canvas>
                            <!-- Status overlay -->
                            <div id="step3d-status">Upload a STEP file and click "Render 3D" to view</div>
                            <!-- Loading spinner overlay -->
                            <div id="step3d-loading" class="step3d-loading hidden">
                                <div class="step3d-spinner"></div>
                                <span id="step3d-loading-text">Loading…</span>
                            </div>
                            <!-- Viewer toolbar -->
                            <div class="step3d-toolbar">
                                <button class="step3d-btn" id="step3d-btn-reset" onclick="stepViewer.resetView()"
                                    title="Fit to view">⊡ Fit</button>
                                <button class="step3d-btn" id="step3d-btn-wire" onclick="stepViewer.toggleWireframe()"
                                    title="Toggle wireframe">⬡ Wire</button>
                            </div>
                            <!-- Face-click tooltip -->
                            <div id="step3d-face-tip" class="step3d-face-tip" style="display:none;"></div>
                        </div>
                        <button id="visualize-btn" class="visualize-btn hidden">Visualize Model</button>
                    </div>

                    <!-- Preview -->
                    <div class="tab-panel" id="panel-preview">
                        <div id="preview-placeholder" class="placeholder">
                            Upload and render to see preview images
                        </div>
                        <div id="preview-viewer" class="preview-viewer hidden">
                            <div class="zoom-toolbar">
                                <button class="zoom-btn" onclick="zoomOut()">−</button>
                                <span id="zoom-pct">100%</span>
                                <button class="zoom-btn" onclick="zoomIn()">+</button>
                                <button class="zoom-btn" onclick="zoomReset()">Reset</button>
                            </div>
                            <div id="view-strip" class="view-strip"></div>
                            <div class="view-main-wrap">
                                <img id="view-main-img" class="view-main-img" src="" alt="CAD view">
                            </div>
                            <span id="view-main-label" class="view-main-label"></span>
                        </div>
                    </div>

                    <!-- JSON -->
                    <div class="tab-panel" id="panel-json">
                        <div class="code-container">
                            <pre id="json-viewer" class="code-viewer">Generate a model to view JSON output</pre>
                        </div>
                    </div>

                    <!-- Python -->
                    <div class="tab-panel" id="panel-python">
                        <div class="code-container">
                            <pre id="python-viewer" class="code-viewer">Generate a model to view Python code</pre>
                        </div>
                    </div>

                    <!-- STEP -->
                    <div class="tab-panel" id="panel-step">
                        <div class="step-info" id="step-info">
                            <p class="step-placeholder">Generate a model to view STEP file</p>
                        </div>
                        <div class="code-container" id="step-code-container" style="display:none">
                            <pre id="step-code-viewer" class="code-viewer"></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Column: Parameters (25%) -->
            <aside class="right-column">
                <div class="right-params-header">
                    <label class="section-label">PARAMETERS</label>
                </div>
                <div class="right-params-body">
                    <div id="parameters-form" class="parameters-form">
                        <p class="params-placeholder">Generate a model to edit parameters</p>
                    </div>
                    <button id="regenerate-btn" class="regenerate-btn hidden">Regenerate Model</button>
                </div>
            </aside>
        </main>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-message">Processing...</p>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container" class="toast-container"></div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/step-viewer.js"></script>
    <script src="js/app.js"></script>
</body>

</html>